# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды:
1. Выполнить команду для установки зависимостей:
```
npm install
```
или
```
yarn
```
2. Запустить проект командой:
```
npm run start
```
или
```
yarn start
```
## Сборка проекта
```
npm run build
```
или
```
yarn build
```

## Архитектура проекта

Проект представляет собой типовой интернет-магазин с товарами для разработчиков.

Приложение разработанно согласно шаблону программирования **Model-View-Presenter (MVP)**. Данный шаблон разделяет архитектуру приложения на три модуля: 
1. **Модель (Model)** - содержит основную логику приложения, отвечает за данные, методы работы с ними и структуру программы.
2. **Представление (View)** - отвечает за визуализацию информации, которую получает от модели. View отображает данные на уровне пользовательского интерфейса.
3. **Презентор (Presenter)** - действует как мост между моделью и представлением. Извлекает данные из модели и обновляет представление, обеспечивая правильное представление данных.

Взаимодействия внутри приложения происходят через события. Модели инициализируют события, слушатели событий в основном коде выполняют передачу данных компонентам отображения, а также вычислениями между этой передачей, и еще они меняют значения в моделях.
 
## Интерфейсы описывающие основные данные в проекте

+ Интерфейс **IProduct** описывает карточку товара.

```ts
interface IProduct {
  id: string; - уникальный id товара
  description: string; - описание товара
  image: string; - ссылка на картинку
  title: string; - заголовой товара
  category: string; - категория
  price: number | null; - цена
};
```

+ Интерфейс **IResponseProducts** описывает ответ с бэкенда с каточками товаров и их количеством.

```ts
interface IResponseProducts {
  total: number; - количество товаров
  items: IProduct[]; - массив товаров
};
```

+ Интерфейс **IResponseOrder** описывает ответ после успешной отправки данных о заказе, ответ состоит из итоговой суммы и id заказа.

```ts
interface IResponseOrder {
  id: string; - id заказа
  total: number; - итоговая цена
};
```

+ Интерфейс **IOrder** описывает данные, которые нужно отправить на бэкенд для формирования заказа, расширяется интерфейсами **IOrderContacts** и **IOrderData**

```ts
interface IOrder extends IOrderContacts, IOrderData {
  total: number; - итоговая цена
  items: string[]; - id товаров
};

interface IOrderContacts {
  email: string; - электронная почта
  phone: string; - телефон
};

interface IOrderData {
  payment: string; - способ оплаты
  address: string; - адресс доставки
};
```

+ Интерфейс **IBasket** описывает данные корзины товаров, состоит из массива id продуктов и итоговой суммы.

```ts
interface IBasket {
  items: string[]; - id товаров добавленных в корзину 
  total: number; - итоговая цена товаров добавленных в корзину 
};
```
*** 

## Базовые классы в проекте

**api** - данный класс содержит в себе логику отправки запросов на сервер.  

В конструктор принимает:   
+ ```constructor(baseUrl: string, options: RequestInit = {})``` - базовый url на который будет совершен запрос, необязательный параметр - опции для запросов.   

Поля класса:   
+ ```readonly baseUrl: string``` - адресс сервера.
+ ```protected options: RequestInit``` - опциональный обьект, содержит в себе заголовки запросов.
 
Имеет методы:   
+ ```handleResponse<T>(response: Response): Promise<T>``` - обрабатывает ответ с сервера, проверяет успешен ответ или нет.
+ ```get<T>(uri: string)``` - осуществляет GET запрос на сервер, аргументом принимает эндпоинт.
+ ```post<T>(uri: string, data: object, method: ApiPostMethods = 'POST')``` - осуществляет POST/PATCH/DELETE запрос на сервер, аргументом принимает эндпоинт, данные, которые нужно передать на сервер, и метод запроса .

***

**Component** - абрастактный класс, который расширяют все элементы отображения.

В конструктор принимает:   
+ ```constructor(protected readonly container: HTMLElement)``` - контейнер, в котом будет отображаться контент.

Имеет методы:   
+ ``` toggleClass(element: HTMLElement, className: string, force?: boolean)``` - данный метод переключает класс элемента.
+ ```setText(element: HTMLElement, value: unknown)``` - данный метод позволяет задать текст элемента.
+ ```setDisabled(element: HTMLElement, state: boolean)``` - блокирует элемент, добавляя ему атрибут 'disabled'.
+ ```setHidden(element: HTMLElement)``` - скрывает элемент.
+ ```setVisible(element: HTMLElement)``` - показывает элемент.
+ ```setImage(element: HTMLImageElement, src: string, alt?: string)``` - позволяет в img элемент установить ссылку на картинку и альтернативный текст.
+ ```render(data?: Partial<T>)``` - возвращает container для отображения на странице.

***

**EventEmitter** - класс позволяет создавать кастомные события и подписываться на них (брокер событий).

В конструктор ничего не принимает.

Поля класса:   
+ ```_events: Map<EventName, Set<Subscriber>>``` - хранит в себе map коллекцию уникальных событий.

Имеет методы:   
+ ```on<T extends object>(eventName: EventName, callback: (event: T) => void)``` - установить обработчик события
+ ```off(eventName: EventName, callback: Subscriber)``` - Снять обработчик с события
+ ```emit<T extends object>(eventName: string, data?: T)``` - Инициировать событие с данными
+ ```onAll(callback: (event: EmitterEvent) => void)``` - Слушать все события
+ ```offAll()``` - Сбросить все обработчики
+ ```trigger<T extends object>(eventName: string, context?: Partial<T>)``` - Сделать коллбек триггер, генерирующий событие при вызове

***

**Form** - расширяет класс **Component**. Класс для компонентов формы, реализует методы для валидации формы и управления состоянием.

В конструктор принимает:   
+ ```constructor(protected container: HTMLFormElement, protected events: IEvents)``` - котейнер формы и обработчик событий.

Поля класса:   
+ ```_submit: HTMLButtonElement;``` - кнопка в форме для события инпут
+ ```_errors: HTMLElement;``` - HTML-элемент для вывода ошибки

Имеет методы:   
+ ```onInputChange(field: keyof T, value: string)``` - данный метод реагирует на изменение полей ввода
+ ```valid(value: boolean)``` - сеттер для установки валидности поля
+ ```errors(value: string)``` - сеттер для установки текста ошибки
+ ```render(state: Partial<T> & IFormState)``` - возвращает container для отображения на странице.

***

**Model** - абстрактный класс для модели данных 

В конструктор принимает:   
+ ```constructor(data: Partial<T>, protected events: IEvents)``` - обьект с данными модели и обработчик событий. 

Имеет методы:   
+ ```emitChanges(event: string, payload?: object)``` - Сообщает всем подписчикам что модель поменялась.

***

## Классы модели данных (Model)

**WebLarekApi** - класс раширяет базовый класс **Api** и соотвествует интерфейсу **IWebLarekApi**. Данный класс нужен для GET и POST запросов на сервер для получения карточек и отправки данных на сервер.

В конструктор принимает:   
+ ```constructor(baseUrl: string, options: RequestInit = {})``` - базовый url на который будет совершен запрос, необязательный параметр - опции для запросов. 

Поля класса:   
+ ```readonly baseUrl: string``` - адресс сервера.
+ ```protected options: RequestInit``` - опциональный обьект, содержит в себе заголовки запросов.

Имеет методы:   
+ ```getCatalog()``` - осуществляет GET запрос на сервер, в ответ принимает промисс с карточками товаров, который соотвествует интерфейсу **IResponseProducts**
+ ```getProduct(id: string)``` - осуществляет GET запрос на сервер, в ответ принимает промисс с карточкой товара которая соотвествует переданному id
+ ```setOrder(data: IOrder)``` - осуществляет POST запрос на сервер, передает данные которые должны соотвествовать интерфейсу **IOrder**. В ответ принимает промисс с информацией о заказе, который должен соотвествовать интерфейсу **IResponseOrder**

***

**WebLarekModel** - класс раширяет базовый класс **Model**, которой передает интерфейс с полями **IWebLarekModelData** и соотвествует интерфейсу **IWebLarekModel**. 

В конструктор ничего не принимает. 

Поля класса:   
+ ```_products: IProduct[]``` - хранит массив обьектов карточек товаров.
+ ```_basket: IBasket``` - хранит в себе данные id товаров и общую стоимость в корзине
+ ```_order: IOrder``` - хранит в себе нужные данные для отправки на сервер
+ ```formErrors: TFormErrors``` - хранит в себе обьект с сообщениями об ошибке при валидации формы

Имеет методы:   
+ ```set products: IProduct[]``` - сеттер для сохранение массива карточек товара в поле класса **_products**
+ ```get products: IProduct[]``` - геттер для получения массива карточек из поля класса **_products**
+ ```getProduct(id: string): IProduct``` - позволяет найти нужный обьект карточки из поля класса **_products** по id
+ ```addToBasket(item: IProduct): void``` - добавляет id товара и стоимость товара в поле класса **_basket**
+ ```deleteFromBasket(item: IProduct): void``` - удаляет id товара и стоимость товара в поле класса **_basket**
+ ```setOrder(): void``` - записывает в поля обекта **_order** id и стоимость всех товаров из корзины
+ ```clearOrder(): void``` - очищает поля класса **_products** и **_basket** после успешного заказа
+ ```getTotalBasket(): number``` - возвращает стоимость всех товаров в корзине
+ ```getTotalOrder(): number``` - - возвращает стоимость всех товаров из поля **_order**
+ ```inBasket(id: string): boolean``` - проверяет есть ли данный товар в корзине
+ ```getSizeBasket(): number``` - возращает количество товаров в корзине
+ ```setContactsField(field: keyof IOrderContacts, value: string): void``` - устанавливает данные, которые соотвествуют интрейфейсу **IOrderContacts** в поле класса **_order**
+ ```setOrderField(field: keyof IOrderData, value: string): void``` - устанавливает данные, которые соотвествуют интрейфейсу **IOrderData** в поле класса **_order** 
+ ```validateOrderField(): boolean``` - проверяет все ли поля с данными поля класса **_order** заполнены
***

## Классы представления (View)

**Page** - класс раширяет базовый класс **Component**, отвечает за отображение контента на главной странице: карточек товаров, счетчика товаров в корзине и вешает на элемент корзины обрабочик клика мыши, блокирует скролл страницы при открытом модальном окне.

В конструктор принимает:   
+ ```protected container: HTMLElement, protected event: IEvents``` - контейнер для отображения контента и обработчик событий.

Поля класса:   
+ ```basketElement: HTMLButtonElement``` - элемент кнопки козины.
+ ```basketCounter: HTMLElement``` - элемент счетчика количества товаров в корзине.
+ ```galleryElement: HTMLElement``` - контейнер для карточек.
+ ```wrapperElement: HTMLElement``` - элемент странцы на который нужно повесить класс для блокировки скролла.

Имеет методы:   
+ ```catalog(items: HTMLElement[])``` - метод для установки карточек в контейнер для отображения на странице.
+ ```counter(value: number)``` - устанавливает значение счетчика товаров в корзине.
+ ```locked(value: boolean)``` - метод для блокировки скролла страницы.

***

**Card** - класс раширяет базовый класс **Component**, отвечает за заполнение элемента карточки контентом и ее отображение на странице.

В конструктор принимает:   
+ ```protected container: HTMLElement, protected cdn: string, protected actions?: IActions``` - шаблон элемента карточки, cdn для получения полной ссылки на картинку и обработчик клика.

Поля класса:   
+ ```categoryElement: HTMLElement``` - элемент карточки для отображения категории товара.
+ ```titleElement: HTMLElement``` - элемент карточки для отображения заголовка товара.
+ ```imageElement: HTMLImageElement``` - элемент карточки для отображения картинки товара.
+ ```priceElement: HTMLElement``` - элемент карточки для отображения цены товара.
+ ```descriptionElement: HTMLElement``` - элемент карточки для отображения описания товара.
+ ```buttonElement?: HTMLButtonElement``` - элемент кнопки карточки для удаления из корзины.
+ ```indexElement?: HTMLElement``` - элемент карточки для отображения номера товара в корзине.

Имеет методы:   
+ ```category(value: TCategory)``` - сеттер для заполнения категории товара, меняет класс элемента в зависимости от текста.
+ ```title(value: string)``` - сеттер для заполнения заголовка товара.
+ ```image(value: string)``` - сеттер для заполнения сылки на картинку и установления атрибута alt.
+ ```price(value: number | null)``` - сеттер для заполнения цены товара, блокирует кнопку, если цена соотвествует 'null'.
+ ```description(value: string)``` - сеттер для заполнения описания товара
+ ```index(value: number)``` - сеттер для заполнения индекса товара для отображения его в корзине.

***

**Basket** - класс раширяет базовый класс **Component**, отвечает за заполнение элемента корзины контентом и ее отображение на странице.

В конструктор принимает:   
+ ```protected container: HTMLElement, protected event: IEvents``` - шаблон элемента карточки и обработчик событий.

Поля класса:   
+ ```containerElement: HTMLUListElement``` - элемент для отображения карточек товара в корзине.
+ ```buttonElement: HTMLButtonElement``` - элемент кнопки для оформления заказа.
+ ```priceElement: HTMLElement``` - элемент для отображения общей стоимости товаров в корзине.

Имеет методы:   
+ ```items(items: HTMLElement[])``` - сеттер для установки карточек в контейнер для отображения в корзине, если карточки отсутствуют, то отображает текст 'Корзина пуста'.
+ ```selected(items: string[])``` - сеттер для блокировки кнопки, если товаров нет в корзине.
+ ```price(value: number)``` - сеттер для отображения общей стоимости товаров в корзине.

***

**Modal** - класс раширяет базовый класс **Component**, отвечает за отображение контента в модальном окне.

В конструктор принимает:   
+ ```protected container: HTMLElement, protected event: IEvents``` -  контейнер для модального окна и обработчик событий.

Поля класса:   
+ ```closeButtonElement: HTMLButtonElement``` - элемент кнопки для закрытия модального окна.
+ ```contentElement: HTMLElement``` - контейнер для контента модального окна.

Имеет методы:   
+ ```open()``` - метод для открытия модального окна.
+ ```close()``` - метод для закрытия модального окна.
+ ```content(element: HTMLElement)``` - сеттер для установки контента в модальное окно.
+ ```render(data: IModal)``` - рендер контента для отображения его в модальном окне.

***

**Success** - класс раширяет базовый класс **Component**, отвечает за отображение информации об успешном оформлении заказа и отображение списанной суммы.

В конструктор принимает:   
+ ```protected container: HTMLElement, protected actions?: IActions``` - шаблон элемента карточки и обработчик клика мыши.

Поля класса:   
+ ```desciptionElement: HTMLElement``` - элемент для отображения списанной суммы.
+ ```successButton: HTMLButtonElement``` - кнопка закрытия окна.

Имеет методы:   
+ ```total(value: number)``` - сеттер для отображения списанной суммы.

***

**Contacts** - класс раширяет базовый класс **Form**, отвечает за отображение формы и спосбов полей ввода электронной почты и телефона.

В конструктор принимает:   
+ ```protected container: HTMLFormElement, protected event: IEvents``` - шаблон элемента формы и обработчик событий.
 
Имеет методы:   
```email(value: string)``` - сеттер для установки электронной почты.
```phone(value: string)``` - сеттер для установки телефона.

***

**Order** - класс раширяет базовый класс **Form**, отвечает за отображение формы и спосбов оплаты товаров и адресса доставки.  

В конструктор принимает:   
+ ```protected container: HTMLFormElement, protected event: IEvents``` - шаблон элемента формы и обработчик событий.  

Поля класса:   
+ ```cardButtonElement: HTMLButtonElement``` - кнопка для указания способа оплаты онлайн.
+ ```cashButtonElement: HTMLButtonElement``` - кнопка для указания способа оплаты при получении.

Имеет методы:   
+ ```payment(value: TPaymentMethod)``` - сеттер для переключеения активной кнопки.
+ ```address(value: string)``` - сеттер для установки адреса.

***

## Презентер (Presenter)

Презентер не выделен в отдельный класс, а располагается в главном скрипте приложения **src\index.ts**.
